<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administración - Quirofísicos Rocha</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./css/adminOptions.css">
  <script>
    // Quick authentication check before page loads
    console.log('Admin auth check:');
    console.log('user_token:', localStorage.getItem('user_token'));
    console.log('token:', localStorage.getItem('token'));
    console.log('user_role:', localStorage.getItem('user_role'));
    
    const hasToken = localStorage.getItem('user_token') || localStorage.getItem('token');
    const isAdmin = localStorage.getItem('user_role') === 'admin';
    
    console.log('hasToken:', hasToken);
    console.log('isAdmin:', isAdmin);
    
    if (!hasToken || !isAdmin) {
      console.log('Authentication failed, redirecting to login');
      alert('Acceso denegado. Solo los administradores pueden acceder a esta página.');
      window.location.href = '/login.html';
    } else {
      console.log('Initial auth check passed');
    }
  </script>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html">
        <i class="fas fa-spine me-2"></i>
        Quirofísicos Rocha
      </a>
      <div class="d-flex align-items-center">
        <span class="badge bg-warning text-dark me-3">Admin Panel</span>
        <span class="navbar-text me-3" id="admin-name">Cargando...</span>
        <a href="../index.html" class="btn btn-outline-light btn-sm me-2">
          <i class="fas fa-home"></i> Sitio Principal
        </a>
        <button class="btn btn-outline-light btn-sm" id="logout-btn">
          <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
        </button>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="appointments">
                <i class="fas fa-calendar-check"></i> Citas
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="users">
                <i class="fas fa-users"></i> Usuarios
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="schedule">
                <i class="fas fa-calendar-alt"></i> Gestión de Horarios
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="settings">
                <i class="fas fa-cogs"></i> Configuración
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="sms-management">
                <i class="fas fa-sms"></i> Gestión SMS
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2" id="page-title">Dashboard</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group me-2">
              <button type="button" class="btn btn-sm btn-outline-secondary" id="refresh-btn">
                <i class="fas fa-sync-alt"></i> Actualizar
              </button>
            </div>
          </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="admin-section">
          <div class="row">
            <div class="col-md-3 mb-4">
              <div class="card text-white bg-primary dashboard-card" onclick="adminPanel.navigateToSection('users')" style="cursor: pointer;">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <div>
                      <h6 class="card-title">Total Usuarios</h6>
                      <h2 id="total-users">0</h2>
                    </div>
                    <div class="align-self-center">
                      <i class="fas fa-users fa-2x"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="card text-white bg-success dashboard-card" onclick="adminPanel.navigateToSection('appointments')" style="cursor: pointer;">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <div>
                      <h6 class="card-title">Total Citas</h6>
                      <h2 id="total-appointments">0</h2>
                    </div>
                    <div class="align-self-center">
                      <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="card text-white bg-warning dashboard-card" onclick="adminPanel.navigateToSection('appointments', 'today')" style="cursor: pointer;">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <div>
                      <h6 class="card-title">Citas Hoy</h6>
                      <h2 id="today-appointments">0</h2>
                    </div>
                    <div class="align-self-center">
                      <i class="fas fa-calendar-day fa-2x"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-3 mb-4">
              <div class="card text-white bg-info dashboard-card" onclick="adminPanel.navigateToSection('appointments', 'pending')" style="cursor: pointer;">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <div>
                      <h6 class="card-title">Pendientes</h6>
                      <h2 id="pending-appointments">0</h2>
                    </div>
                    <div class="align-self-center">
                      <i class="fas fa-clock fa-2x"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Appointments -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">
                    <a href="#" class="text-decoration-none text-dark" data-section="appointments" onclick="showSection('appointments')">
                      <i class="fas fa-calendar-check me-2"></i>Citas Recientes
                    </a>
                  </h5>
                  <a href="#" class="btn btn-sm btn-outline-primary" data-section="appointments" onclick="showSection('appointments')">
                    Ver todas <i class="fas fa-arrow-right ms-1"></i>
                  </a>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>Fecha</th>
                          <th>Hora</th>
                          <th>Paciente</th>
                          <th>Estado</th>
                          <th>Acciones</th>
                        </tr>
                      </thead>
                      <tbody id="recent-appointments">
                        <tr>
                          <td colspan="5" class="text-center">Cargando...</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Appointments Section -->
        <div id="appointments-section" class="admin-section d-none">
          <!-- Standardized Section Header -->
          <div class="section-header">
            <h2>
              <i class="fas fa-calendar-check me-2 text-primary"></i>Gestión de Citas
            </h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="#" onclick="showSection('dashboard')" class="text-decoration-none">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Citas</li>
              </ol>
            </nav>
          </div>
          
          <!-- Standardized Controls Bar -->
          <div class="controls-bar">
            <div class="row">
              <div class="col-md-5">
                <label class="form-label fw-bold">Búsqueda</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="appointments-search" placeholder="Buscar por nombre, email o teléfono...">
                  <button class="btn btn-outline-secondary" type="button" id="search-appointments-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-bold">Estado</label>
                <select class="form-select" id="appointments-status-filter">
                  <option value="">Todos los estados</option>
                  <option value="pending">Pendiente</option>
                  <option value="confirmed">Confirmada</option>
                  <option value="completed">Completada</option>
                  <option value="cancelled">Cancelada</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-bold">Fecha</label>
                <input type="date" class="form-control" id="appointments-date-filter">
              </div>
              <div class="col-md-1">
                <label class="form-label fw-bold text-white">.</label>
                <button type="button" class="btn btn-primary w-100" id="refresh-appointments-btn">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Standardized Content Card -->
          <div class="content-card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>Lista de Citas
              </h5>
              <div class="text-muted small">
                <span id="appointments-total-count">Cargando...</span>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table standard-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Fecha</th>
                      <th>Hora</th>
                      <th>Paciente</th>
                      <th>Contacto</th>
                      <th>Estado</th>
                      <th width="140">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="appointments-table">
                    <tr>
                      <td colspan="7" class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div>Cargando citas...</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Standardized Pagination -->
              <div class="standard-pagination">
                <nav aria-label="Paginación de citas">
                  <ul class="pagination" id="appointments-pagination">
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="admin-section d-none">
          <!-- Standardized Section Header -->
          <div class="section-header">
            <h2>
              <i class="fas fa-users me-2 text-success"></i>Gestión de Usuarios
            </h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="#" onclick="showSection('dashboard')" class="text-decoration-none">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Usuarios</li>
              </ol>
            </nav>
          </div>
          
          <!-- Standardized Controls Bar -->
          <div class="controls-bar">
            <div class="row">
              <div class="col-md-6">
                <label class="form-label fw-bold">Búsqueda</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="users-search" placeholder="Buscar por nombre o email...">
                  <button class="btn btn-outline-secondary" type="button" id="search-users-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-bold">Rol</label>
                <select class="form-select" id="users-role-filter">
                  <option value="">Todos los roles</option>
                  <option value="user">Usuario</option>
                  <option value="admin">Administrador</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label fw-bold text-white">.</label>
                <button type="button" class="btn btn-success w-100" id="add-user-btn">
                  <i class="fas fa-plus"></i> Nuevo
                </button>
              </div>
              <div class="col-md-1">
                <label class="form-label fw-bold text-white">.</label>
                <button type="button" class="btn btn-primary w-100" id="refresh-users-btn">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Standardized Content Card -->
          <div class="content-card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-list me-2"></i>Lista de Usuarios
              </h5>
              <div class="text-muted small">
                <span id="users-total-count">Cargando...</span>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table standard-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Nombre</th>
                      <th>Email</th>
                      <th>Teléfono</th>
                      <th>Rol</th>
                      <th>Registro</th>
                      <th width="140">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="users-table">
                    <tr>
                      <td colspan="7" class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div>Cargando usuarios...</div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Standardized Pagination -->
              <div class="standard-pagination">
                <nav aria-label="Paginación de usuarios">
                  <ul class="pagination" id="users-pagination">
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>

        <!-- Schedule Management Section -->
        <div id="schedule-section" class="admin-section d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0">
              <i class="fas fa-calendar-alt me-2 text-primary"></i>Gestión de Horarios
            </h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                  <a href="#" onclick="showSection('dashboard')" class="text-decoration-none">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Horarios</li>
              </ol>
            </nav>
          </div>

          <!-- Schedule Management Tabs -->
          <ul class="nav nav-tabs mb-4" id="schedule-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="business-hours-tab" data-bs-toggle="tab" data-bs-target="#business-hours" type="button" role="tab">
                <i class="fas fa-clock me-2"></i>Horarios Regulares
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="schedule-exceptions-tab" data-bs-toggle="tab" data-bs-target="#schedule-exceptions" type="button" role="tab">
                <i class="fas fa-calendar-times me-2"></i>Excepciones y Cierres
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="announcements-tab" data-bs-toggle="tab" data-bs-target="#announcements" type="button" role="tab">
                <i class="fas fa-bullhorn me-2"></i>Anuncios Públicos
              </button>
            </li>
          </ul>

          <div class="tab-content" id="schedule-tab-content">
            
            <!-- Business Hours Tab -->
            <div class="tab-pane fade show active" id="business-hours" role="tabpanel">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-clock me-2"></i>Horarios Semanales Estándar</h5>
                  <small class="text-muted">Configure los horarios regulares de atención para cada día de la semana</small>
                </div>
                <div class="card-body">
                  <div id="business-hours-container">
                    <!-- Business hours will be loaded here -->
                  </div>
                  <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="button" class="btn btn-outline-secondary" id="reset-business-hours">
                      <i class="fas fa-undo"></i> Restablecer
                    </button>
                    <button type="button" class="btn btn-primary" id="save-business-hours">
                      <i class="fas fa-save"></i> Guardar Horarios
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Schedule Exceptions Tab -->
            <div class="tab-pane fade" id="schedule-exceptions" role="tabpanel">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-calendar-times me-2"></i>Excepciones de Horario</h5>
                  <small class="text-muted">Gestione cierres completos, horarios especiales y excepciones temporales</small>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6>Excepciones Programadas</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addScheduleExceptionModal">
                      <i class="fas fa-plus"></i> Nueva Excepción
                    </button>
                  </div>
                  <div id="schedule-exceptions-list">
                    <!-- Schedule exceptions will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Announcements Tab -->
            <div class="tab-pane fade" id="announcements" role="tabpanel">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-bullhorn me-2"></i>Anuncios y Banners</h5>
                  <small class="text-muted">Gestione los anuncios que aparecen en la página principal del sitio web</small>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6>Anuncios Activos</h6>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAnnouncementModal">
                      <i class="fas fa-plus"></i> Nuevo Anuncio
                    </button>
                  </div>
                  <div id="announcements-list">
                    <!-- Announcements will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="admin-section d-none">
          <!-- Standardized Section Header -->
          <div class="section-header">
            <h2>
              <i class="fas fa-cogs me-2 text-warning"></i>Configuración del Sistema
            </h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="#" onclick="showSection('dashboard')" class="text-decoration-none">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Configuración</li>
              </ol>
            </nav>
          </div>
          
          <!-- Clean Configuration Tabs -->
          <ul class="nav nav-tabs" id="settings-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="general-settings-tab" data-bs-toggle="tab" data-bs-target="#general-settings" type="button" role="tab">
                <i class="fas fa-cog me-2"></i>Configuración General
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="hours-exceptions-tab" data-bs-toggle="tab" data-bs-target="#hours-exceptions" type="button" role="tab">
                <i class="fas fa-clock me-2"></i>Excepciones de Horario
              </button>
            </li>
          </ul>

          <div class="tab-content" id="settings-tab-content">
            <!-- General Settings Tab -->
            <div class="tab-pane fade show active" id="general-settings" role="tabpanel">
              <div class="content-card">
                <div class="card-header">
                  <h5 class="mb-0">
                    <i class="fas fa-cog me-2"></i>Configuración General de la Clínica
                  </h5>
                </div>
                <div class="card-body">
                  <form id="clinic-settings-form">
                    <!-- Settings will be loaded here -->
                  </form>
                  <div class="d-flex justify-content-end gap-2 mt-4">
                    <button type="button" class="btn btn-outline-secondary" id="reset-settings">
                      <i class="fas fa-undo"></i> Restablecer
                    </button>
                    <button type="button" class="btn btn-primary" id="save-settings">
                      <i class="fas fa-save"></i> Guardar Configuración
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Hours Exceptions Tab -->
            <div class="tab-pane fade" id="hours-exceptions" role="tabpanel">
              <div class="card">
                <div class="card-header">
                  <h5><i class="fas fa-clock me-2"></i>Excepciones de Horario</h5>
                  <small class="text-muted">Bloquee horarios específicos para un día o rango de fechas</small>
                </div>
                <div class="card-body">
                  <div class="row mb-4">
                    <div class="col-md-8">
                      <div class="card border-info">
                        <div class="card-header bg-info text-white">
                          <h6 class="mb-0"><i class="fas fa-ban me-2"></i>Nueva Excepción de Horario</h6>
                        </div>
                        <div class="card-body">
                          <form id="hours-exception-form">
                            <!-- Date Range -->
                            <div class="row">
                              <div class="col-md-6">
                                <div class="mb-3">
                                  <label for="exception-start-date" class="form-label">Fecha Inicial</label>
                                  <input type="date" class="form-control" id="exception-start-date" required>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="mb-3">
                                  <label for="exception-end-date" class="form-label">Fecha Final (opcional)</label>
                                  <input type="date" class="form-control" id="exception-end-date">
                                  <small class="text-muted">Dejar vacío para aplicar solo a la fecha inicial</small>
                                </div>
                              </div>
                            </div>
                            
                            <!-- Time Range to Block -->
                            <div class="row">
                              <div class="col-md-6">
                                <div class="mb-3">
                                  <label for="exception-block-start" class="form-label">Hora de Inicio del Bloqueo</label>
                                  <input type="time" class="form-control" id="exception-block-start" required>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="mb-3">
                                  <label for="exception-block-end" class="form-label">Hora de Fin del Bloqueo</label>
                                  <input type="time" class="form-control" id="exception-block-end" required>
                                </div>
                              </div>
                            </div>
                            
                            <div class="mb-3">
                              <label for="exception-reason" class="form-label">Motivo (opcional)</label>
                              <input type="text" class="form-control" id="exception-reason" placeholder="Ej: Almuerzo extendido, Reunión, Capacitación">
                            </div>
                            
                            <button type="button" class="btn btn-info" onclick="adminPanel.addHoursException()">
                              <i class="fas fa-plus"></i> Crear Excepción
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="card border-secondary">
                        <div class="card-header bg-secondary text-white">
                          <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Cómo Funciona</h6>
                        </div>
                        <div class="card-body">
                          <ol class="list-unstyled">
                            <li class="mb-2">
                              <span class="badge bg-primary me-2">1</span>
                              <strong>Fechas</strong><br>
                              <small class="text-muted">Defina fecha inicial y opcionalmente fecha final</small>
                            </li>
                            <li class="mb-2">
                              <span class="badge bg-success me-2">2</span>
                              <strong>Horario</strong><br>
                              <small class="text-muted">Especifique el rango de horas a bloquear</small>
                            </li>
                            <li class="mb-2">
                              <span class="badge bg-warning me-2">3</span>
                              <strong>Efecto</strong><br>
                              <small class="text-muted">La disponibilidad se cancela para esas horas</small>
                            </li>
                          </ol>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Current Exceptions List -->
                  <div class="card">
                    <div class="card-header">
                      <h6><i class="fas fa-list me-2"></i>Excepciones Programadas</h6>
                    </div>
                    <div class="card-body">
                      <div id="hours-exceptions-list">
                        <!-- Will be populated by JavaScript -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SMS Management Section -->
        <div id="sms-management-section" class="admin-section d-none">
          <!-- Standardized Section Header -->
          <div class="section-header">
            <h2>
              <i class="fas fa-sms me-2 text-info"></i>Gestión de SMS
            </h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="#" onclick="showSection('dashboard')" class="text-decoration-none">Dashboard</a>
                </li>
                <li class="breadcrumb-item active">Gestión SMS</li>
              </ol>
            </nav>
          </div>
          
          <!-- SMS Management Tabs -->
          <ul class="nav nav-tabs" id="sms-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="pending-approvals-tab" data-bs-toggle="tab" data-bs-target="#pending-approvals" type="button" role="tab">
                <i class="fas fa-clock me-2"></i>Citas Pendientes
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="user-verification-tab" data-bs-toggle="tab" data-bs-target="#user-verification" type="button" role="tab">
                <i class="fas fa-user-check me-2"></i>Verificación de Usuarios
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="send-reminders-tab" data-bs-toggle="tab" data-bs-target="#send-reminders" type="button" role="tab">
                <i class="fas fa-bell me-2"></i>Enviar Recordatorios
              </button>
            </li>
          </ul>

          <div class="tab-content" id="sms-tab-content">
            <!-- Pending Appointments Tab -->
            <div class="tab-pane fade show active" id="pending-approvals" role="tabpanel">
              <div class="content-card">
                <div class="card-header">
                  <h5 class="mb-0">
                    <i class="fas fa-clock me-2"></i>Citas Pendientes de Aprobación
                  </h5>
                  <small class="text-muted">Citas de usuarios no verificados que requieren aprobación manual</small>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                      <button type="button" class="btn btn-outline-primary btn-sm" onclick="displayPendingAppointments()">
                        <i class="fas fa-sync-alt"></i> Actualizar Lista
                      </button>
                    </div>
                    <div class="text-muted">
                      <small>Se actualiza automáticamente cada 30 segundos</small>
                    </div>
                  </div>
                  
                  <div id="pending-appointments" class="appointments-container">
                    <!-- Pending appointments will be loaded here by JavaScript -->
                  </div>
                </div>
              </div>
            </div>

            <!-- User Verification Tab -->
            <div class="tab-pane fade" id="user-verification" role="tabpanel">
              <div class="content-card">
                <div class="card-header">
                  <h5 class="mb-0">
                    <i class="fas fa-user-check me-2"></i>Usuarios Pendientes de Verificación
                  </h5>
                  <small class="text-muted">Usuarios que han registrado citas pero aún no han sido verificados</small>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                      <button type="button" class="btn btn-outline-success btn-sm" onclick="loadUnverifiedUsers()">
                        <i class="fas fa-sync-alt"></i> Actualizar Lista
                      </button>
                    </div>
                    <div class="text-muted">
                      <small>Se actualiza automáticamente cada 30 segundos</small>
                    </div>
                  </div>
                  
                  <div id="unverified-users" class="users-container">
                    <!-- Unverified users will be loaded here by JavaScript -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Send Reminders Tab -->
            <div class="tab-pane fade" id="send-reminders" role="tabpanel">
              <div class="content-card">
                <div class="card-header">
                  <h5 class="mb-0">
                    <i class="fas fa-bell me-2"></i>Envío de Recordatorios SMS
                  </h5>
                  <small class="text-muted">Enviar recordatorios de citas a pacientes</small>
                </div>
                <div class="card-body">
                  <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Información:</strong> Los recordatorios se envían automáticamente 24 horas antes de cada cita. 
                    Use este botón solo para enviar recordatorios manuales.
                  </div>
                  
                  <div class="text-center">
                    <button type="button" class="btn btn-primary btn-lg" onclick="sendAppointmentReminders()">
                      <i class="fas fa-paper-plane me-2"></i>
                      Enviar Recordatorios para Mañana
                    </button>
                  </div>
                  
                  <div class="mt-4">
                    <h6>Estado del Servicio SMS:</h6>
                    <div class="alert alert-warning">
                      <i class="fas fa-exclamation-triangle me-2"></i>
                      <strong>Modo de Desarrollo:</strong> Los SMS se registran en la consola del servidor en lugar de enviarse realmente.
                      Configure las credenciales de Twilio en el archivo .env para habilitar el envío real.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Business Day Exception Modal -->
  <div class="modal fade" id="addBusinessDayExceptionModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar Ajuste de Horario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-business-day-exception-form">
            <div class="mb-3">
              <label for="exception-title" class="form-label">Título del Ajuste</label>
              <input type="text" class="form-control" id="exception-title" required placeholder="Ej: Cerrado por feriado, Horario especial, etc.">
            </div>
            <div class="mb-3">
              <label for="exception-description" class="form-label">Descripción</label>
              <textarea class="form-control" id="exception-description" rows="2" placeholder="Detalles del ajuste de horario"></textarea>
            </div>
            <div class="row">
              <div class="col-md-6">
                <label for="exception-start-date" class="form-label">Fecha de Inicio</label>
                <input type="date" class="form-control" id="exception-start-date" required>
              </div>
              <div class="col-md-6">
                <label for="exception-end-date" class="form-label">Fecha de Fin</label>
                <input type="date" class="form-control" id="exception-end-date" required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Ajuste de Horario</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="schedule-adjustment" id="closed-all-day" value="closed" checked>
                <label class="form-check-label" for="closed-all-day">
                  Cerrado todo el día
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="schedule-adjustment" id="custom-hours" value="custom">
                <label class="form-check-label" for="custom-hours">
                  Horario personalizado
                </label>
              </div>
            </div>
            <div id="custom-hours-section" class="mb-3" style="display: none;">
              <div class="row">
                <div class="col-md-6">
                  <label for="custom-open-time" class="form-label">Hora de Apertura</label>
                  <input type="time" class="form-control" id="custom-open-time">
                </div>
                <div class="col-md-6">
                  <label for="custom-close-time" class="form-label">Hora de Cierre</label>
                  <input type="time" class="form-control" id="custom-close-time">
                </div>
              </div>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="exception-recurring">
              <label class="form-check-label" for="exception-recurring">
                Repetir anualmente
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-business-day-exception">Guardar Ajuste</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Appointment Modal -->
  <div class="modal fade" id="editAppointmentModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Cita</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="edit-appointment-form">
            <input type="hidden" id="edit-appointment-id">
            <div class="mb-3">
              <label for="edit-appointment-name" class="form-label">Nombre Completo</label>
              <input type="text" class="form-control" id="edit-appointment-name" required>
            </div>
            <div class="mb-3">
              <label for="edit-appointment-email" class="form-label">Email</label>
              <input type="email" class="form-control" id="edit-appointment-email">
            </div>
            <div class="mb-3">
              <label for="edit-appointment-phone" class="form-label">Teléfono</label>
              <input type="tel" class="form-control" id="edit-appointment-phone">
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="edit-appointment-date" class="form-label">Fecha</label>
                  <input type="date" class="form-control" id="edit-appointment-date" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="edit-appointment-time" class="form-label">Hora</label>
                  <input type="time" class="form-control" id="edit-appointment-time" required>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label for="edit-appointment-status" class="form-label">Estado</label>
              <select class="form-select" id="edit-appointment-status" required>
                <option value="pending">Pendiente</option>
                <option value="confirmed">Confirmada</option>
                <option value="completed">Completada</option>
                <option value="cancelled">Cancelada</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="edit-appointment-note" class="form-label">Notas</label>
              <textarea class="form-control" id="edit-appointment-note" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-appointment-btn">Guardar Cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Usuario</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="edit-user-form">
            <input type="hidden" id="edit-user-id">
            <div class="mb-3">
              <label for="edit-user-name" class="form-label">Nombre Completo</label>
              <input type="text" class="form-control" id="edit-user-name" required>
            </div>
            <div class="mb-3">
              <label for="edit-user-email" class="form-label">Email</label>
              <input type="email" class="form-control" id="edit-user-email" required>
            </div>
            <div class="mb-3">
              <label for="edit-user-phone" class="form-label">Teléfono</label>
              <input type="tel" class="form-control" id="edit-user-phone">
            </div>
            <div class="mb-3">
              <label for="edit-user-role" class="form-label">Rol</label>
              <select class="form-select" id="edit-user-role" required>
                <option value="user">Usuario</option>
                <option value="admin">Administrador</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-user-btn">Guardar Cambios</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Modal -->
  <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
          <p class="mt-2">Procesando...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Closure Modal -->
  <div class="modal fade" id="addClosureModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-calendar-times me-2"></i>Programar Cierre</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-closure-form">
            <div class="mb-3">
              <label for="closure-title" class="form-label">Título *</label>
              <input type="text" class="form-control" id="closure-title" placeholder="Ej: Día de la Independencia" required>
            </div>
            <div class="mb-3">
              <label for="closure-description" class="form-label">Descripción</label>
              <textarea class="form-control" id="closure-description" rows="2" placeholder="Descripción opcional"></textarea>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="closure-start-date" class="form-label">Fecha Inicio *</label>
                <input type="date" class="form-control" id="closure-start-date" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="closure-end-date" class="form-label">Fecha Fin *</label>
                <input type="date" class="form-control" id="closure-end-date" required>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="closure-start-time" class="form-label">Hora Inicio</label>
                <input type="time" class="form-control" id="closure-start-time">
                <small class="text-muted">Dejar vacío para todo el día</small>
              </div>
              <div class="col-md-6 mb-3">
                <label for="closure-end-time" class="form-label">Hora Fin</label>
                <input type="time" class="form-control" id="closure-end-time">
              </div>
            </div>
            <div class="mb-3">
              <label for="closure-type" class="form-label">Tipo de Cierre</label>
              <select class="form-select" id="closure-type">
                <option value="holiday">Feriado</option>
                <option value="vacation">Vacaciones</option>
                <option value="maintenance">Mantenimiento</option>
                <option value="emergency">Emergencia</option>
                <option value="other">Otro</option>
              </select>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="closure-recurring">
              <label class="form-check-label" for="closure-recurring">
                Repetir anualmente
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-closure">Guardar Cierre</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Override Modal -->
  <div class="modal fade" id="addOverrideModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-calendar-day me-2"></i>Horario Especial</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-override-form">
            <div class="mb-3">
              <label for="override-date" class="form-label">Fecha *</label>
              <input type="date" class="form-control" id="override-date" required>
            </div>
            <div class="mb-3">
              <label for="override-reason" class="form-label">Motivo</label>
              <input type="text" class="form-control" id="override-reason" placeholder="Ej: Horario extendido por alta demanda">
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="override-is-open" checked>
              <label class="form-check-label" for="override-is-open">
                Abierto este día
              </label>
            </div>
            <div id="override-times">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="override-open-time" class="form-label">Hora Apertura</label>
                  <input type="time" class="form-control" id="override-open-time" value="09:00">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="override-close-time" class="form-label">Hora Cierre</label>
                  <input type="time" class="form-control" id="override-close-time" value="18:00">
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="override-break-start" class="form-label">Inicio Descanso</label>
                  <input type="time" class="form-control" id="override-break-start" value="13:00">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="override-break-end" class="form-label">Fin Descanso</label>
                  <input type="time" class="form-control" id="override-break-end" value="14:00">
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-override">Guardar Horario</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Blocked Slot Modal -->
  <div class="modal fade" id="addBlockedSlotModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-ban me-2"></i>Bloquear Hora</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-blocked-slot-form">
            <div class="mb-3">
              <label for="blocked-date" class="form-label">Fecha *</label>
              <input type="date" class="form-control" id="blocked-date" required>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="blocked-start-time" class="form-label">Hora Inicio *</label>
                <input type="time" class="form-control" id="blocked-start-time" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="blocked-end-time" class="form-label">Hora Fin *</label>
                <input type="time" class="form-control" id="blocked-end-time" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="blocked-reason" class="form-label">Motivo</label>
              <input type="text" class="form-control" id="blocked-reason" placeholder="Ej: Mantenimiento de equipo">
            </div>
            <div class="mb-3">
              <label for="blocked-type" class="form-label">Tipo de Bloqueo</label>
              <select class="form-select" id="blocked-type">
                <option value="appointment">Cita Reservada</option>
                <option value="break">Descanso</option>
                <option value="maintenance">Mantenimiento</option>
                <option value="personal">Personal</option>
                <option value="other">Otro</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-blocked-slot">Bloquear Hora</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Week Exception Modal -->
  <div class="modal fade" id="addWeekExceptionModal" tabindex="-1" aria-labelledby="addWeekExceptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="addWeekExceptionModalLabel">
            <i class="fas fa-calendar-week me-2"></i>Agregar Excepción Semanal
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="add-week-exception-form">
            <!-- Week Selection -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="exception-week-start" class="form-label fw-bold">
                  <i class="fas fa-calendar me-1"></i>Fecha de inicio de la semana
                </label>
                <input type="date" class="form-control" id="exception-week-start" required>
                <small class="text-muted">Selecciona el lunes de la semana a configurar</small>
              </div>
              <div class="col-md-6">
                <label for="exception-description" class="form-label fw-bold">
                  <i class="fas fa-sticky-note me-1"></i>Descripción
                </label>
                <input type="text" class="form-control" id="exception-description" 
                       placeholder="Ej: Semana de vacaciones, Horario especial navideño">
              </div>
            </div>

            <!-- Exception Type Selection -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="fas fa-cogs me-1"></i>Tipo de Excepción
              </label>
              <div class="row">
                <div class="col-md-6">
                  <div class="card border-warning">
                    <div class="card-body text-center">
                      <input type="radio" class="btn-check" name="exception-type" id="type-closure" value="closure" checked>
                      <label class="btn btn-outline-warning w-100" for="type-closure">
                        <i class="fas fa-times-circle fa-2x d-block mb-2"></i>
                        <strong>Días de Cierre</strong>
                        <br><small>Marcar días específicos como cerrados</small>
                      </label>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-info">
                    <div class="card-body text-center">
                      <input type="radio" class="btn-check" name="exception-type" id="type-schedule" value="schedule">
                      <label class="btn btn-outline-info w-100" for="type-schedule">
                        <i class="fas fa-clock fa-2x d-block mb-2"></i>
                        <strong>Horarios Especiales</strong>
                        <br><small>Configurar horarios diferentes por día</small>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Days Configuration -->
            <div class="card">
              <div class="card-header bg-light">
                <h6 class="mb-0">
                  <i class="fas fa-calendar-alt me-2"></i>Configuración por Día
                </h6>
              </div>
              <div class="card-body">
                <!-- Closure Mode -->
                <div id="closure-mode" class="exception-mode">
                  <p class="text-muted mb-3">
                    <i class="fas fa-info-circle me-1"></i>
                    Selecciona los días que estarán <strong>cerrados</strong> durante esta semana. Los días no marcados mantendrán su horario normal.
                  </p>
                  <div class="row">
                    <div class="col-md-4" data-day="monday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-monday" value="Monday">
                          <label class="form-check-label fw-bold" for="closure-monday">
                            <i class="fas fa-calendar-day me-2"></i>Lunes
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="tuesday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-tuesday" value="Tuesday">
                          <label class="form-check-label fw-bold" for="closure-tuesday">
                            <i class="fas fa-calendar-day me-2"></i>Martes
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="wednesday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-wednesday" value="Wednesday">
                          <label class="form-check-label fw-bold" for="closure-wednesday">
                            <i class="fas fa-calendar-day me-2"></i>Miércoles
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="thursday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-thursday" value="Thursday">
                          <label class="form-check-label fw-bold" for="closure-thursday">
                            <i class="fas fa-calendar-day me-2"></i>Jueves
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="friday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-friday" value="Friday">
                          <label class="form-check-label fw-bold" for="closure-friday">
                            <i class="fas fa-calendar-day me-2"></i>Viernes
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="saturday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-saturday" value="Saturday">
                          <label class="form-check-label fw-bold" for="closure-saturday">
                            <i class="fas fa-calendar-day me-2"></i>Sábado
                          </label>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4" data-day="sunday">
                      <div class="day-closure-card">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="closure-sunday" value="Sunday">
                          <label class="form-check-label fw-bold" for="closure-sunday">
                            <i class="fas fa-calendar-day me-2"></i>Domingo
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Schedule Mode -->
                <div id="schedule-mode" class="exception-mode d-none">
                  <p class="text-muted mb-3">
                    <i class="fas fa-info-circle me-1"></i>
                    Configura horarios especiales para cada día. Deja sin configurar los días que mantendrán su horario normal.
                  </p>
                  
                  <!-- Monday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Lunes</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-monday-enable">
                          <label class="form-check-label text-white" for="schedule-monday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="monday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="monday-closed">
                              <label class="form-check-label text-danger fw-bold" for="monday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="monday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="monday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="monday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="monday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="monday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Tuesday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Martes</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-tuesday-enable">
                          <label class="form-check-label text-white" for="schedule-tuesday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="tuesday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="tuesday-closed">
                              <label class="form-check-label text-danger fw-bold" for="tuesday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="tuesday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="tuesday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="tuesday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="tuesday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="tuesday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Wednesday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Miércoles</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-wednesday-enable">
                          <label class="form-check-label text-white" for="schedule-wednesday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="wednesday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="wednesday-closed">
                              <label class="form-check-label text-danger fw-bold" for="wednesday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="wednesday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="wednesday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="wednesday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="wednesday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="wednesday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Thursday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Jueves</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-thursday-enable">
                          <label class="form-check-label text-white" for="schedule-thursday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="thursday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="thursday-closed">
                              <label class="form-check-label text-danger fw-bold" for="thursday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="thursday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="thursday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="thursday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="thursday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="thursday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Friday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Viernes</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-friday-enable">
                          <label class="form-check-label text-white" for="schedule-friday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="friday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="friday-closed">
                              <label class="form-check-label text-danger fw-bold" for="friday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="friday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="friday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="friday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="friday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="friday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Saturday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Sábado</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-saturday-enable">
                          <label class="form-check-label text-white" for="schedule-saturday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="saturday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="saturday-closed">
                              <label class="form-check-label text-danger fw-bold" for="saturday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="saturday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="saturday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="saturday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="saturday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="saturday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Sunday Schedule -->
                  <div class="day-schedule-card mb-3">
                    <div class="card border-primary">
                      <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-calendar-day me-2"></i>Domingo</span>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="schedule-sunday-enable">
                          <label class="form-check-label text-white" for="schedule-sunday-enable">Configurar</label>
                        </div>
                      </div>
                      <div class="card-body schedule-config d-none" id="sunday-schedule">
                        <div class="row">
                          <div class="col-md-3">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="sunday-closed">
                              <label class="form-check-label text-danger fw-bold" for="sunday-closed">Cerrado</label>
                            </div>
                          </div>
                          <div class="col-md-9" id="sunday-hours">
                            <div class="row">
                              <div class="col-md-3">
                                <label class="form-label small">Apertura</label>
                                <input type="time" class="form-control form-control-sm" id="sunday-open">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Cierre</label>
                                <input type="time" class="form-control form-control-sm" id="sunday-close">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Inicio Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="sunday-break-start">
                              </div>
                              <div class="col-md-3">
                                <label class="form-label small">Fin Almuerzo</label>
                                <input type="time" class="form-control form-control-sm" id="sunday-break-end">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer bg-light">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>Cancelar
          </button>
          <button type="button" class="btn btn-primary" id="save-week-exception">
            <i class="fas fa-save me-1"></i>Guardar Excepción Semanal
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Announcement Modal -->
  <div class="modal fade" id="addAnnouncementModal" tabindex="-1" aria-labelledby="addAnnouncementModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addAnnouncementModalLabel">
            <i class="fas fa-bullhorn me-2"></i>Nuevo Anuncio
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="add-announcement-form">
            <div class="mb-3">
              <label for="announcement-title" class="form-label">Título del Anuncio</label>
              <input type="text" class="form-control" id="announcement-title" required placeholder="Ej: Cambios en horarios de verano">
            </div>
            <div class="mb-3">
              <label for="announcement-content" class="form-label">Contenido</label>
              <textarea class="form-control" id="announcement-content" rows="4" required placeholder="Escriba el contenido del anuncio..."></textarea>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="announcement-type" class="form-label">Tipo de Anuncio</label>
                  <select class="form-select" id="announcement-type">
                    <option value="info">Información</option>
                    <option value="warning">Advertencia</option>
                    <option value="success">Buenas Noticias</option>
                    <option value="urgent">Urgente</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="announcement-priority" class="form-label">Prioridad</label>
                  <select class="form-select" id="announcement-priority">
                    <option value="low">Baja</option>
                    <option value="normal">Normal</option>
                    <option value="high">Alta</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="announcement-start-date" class="form-label">Fecha de inicio</label>
                  <input type="date" class="form-control" id="announcement-start-date" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="announcement-end-date" class="form-label">Fecha de fin (opcional)</label>
                  <input type="date" class="form-control" id="announcement-end-date">
                </div>
              </div>
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="announcement-active" checked>
                <label class="form-check-label" for="announcement-active">
                  Activar inmediatamente
                </label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-announcement">Guardar Anuncio</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Schedule Exception Modal -->
  <div class="modal fade" id="addScheduleExceptionModal" tabindex="-1" aria-labelledby="addScheduleExceptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addScheduleExceptionModalLabel">
            <i class="fas fa-calendar-times me-2"></i>Nueva Excepción de Horario
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="add-schedule-exception-form">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="exception-type-select" class="form-label fw-bold">Tipo de Excepción</label>
                <select class="form-select" id="exception-type-select" required>
                  <option value="">Seleccionar tipo...</option>
                  <option value="single_day">Día específico</option>
                  <option value="date_range">Rango de fechas</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="exception-reason" class="form-label fw-bold">Motivo</label>
                <input type="text" class="form-control" id="exception-reason" placeholder="Ej: Vacaciones, Feriado, Mantenimiento" required>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="exception-start-date" class="form-label fw-bold">Fecha de inicio</label>
                <input type="date" class="form-control" id="exception-start-date" required>
              </div>
              <div class="col-md-6" id="end-date-container" style="display: none;">
                <label for="exception-end-date" class="form-label fw-bold">Fecha de fin</label>
                <input type="date" class="form-control" id="exception-end-date">
              </div>
            </div>

            <div class="card border-primary mb-3">
              <div class="card-header bg-primary text-white">
                <h6 class="mb-0"><i class="fas fa-cogs me-2"></i>Configuración del Horario</h6>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12 mb-3">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="exception-is-closed">
                      <label class="form-check-label fw-bold text-danger" for="exception-is-closed">
                        Cerrado completamente
                      </label>
                    </div>
                  </div>
                </div>
                
                <div id="custom-hours-section">
                  <h6 class="text-muted mb-3">Horario personalizado:</h6>
                  <div class="row">
                    <div class="col-md-3">
                      <label for="exception-open-time" class="form-label">Hora apertura</label>
                      <input type="time" class="form-control" id="exception-open-time" value="09:00">
                    </div>
                    <div class="col-md-3">
                      <label for="exception-close-time" class="form-label">Hora cierre</label>
                      <input type="time" class="form-control" id="exception-close-time" value="18:00">
                    </div>
                    <div class="col-md-3">
                      <label for="exception-break-start" class="form-label">Inicio almuerzo</label>
                      <input type="time" class="form-control" id="exception-break-start" value="13:00">
                    </div>
                    <div class="col-md-3">
                      <label for="exception-break-end" class="form-label">Fin almuerzo</label>
                      <input type="time" class="form-control" id="exception-break-end" value="14:00">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="exception-description" class="form-label">Descripción adicional (opcional)</label>
              <textarea class="form-control" id="exception-description" rows="2" placeholder="Información adicional sobre la excepción..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-schedule-exception">
            <i class="fas fa-save"></i> Guardar Excepción
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../public/js/auth.js"></script>
  <script src="./js/adminOptions.js"></script>
</body>
</html>
